"use client";

import React, { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Button } from "@/components/ui/button";
import { 
  TrendingUp, 
  TrendingDown, 
  AlertTriangle, 
  CheckCircle, 
  Activity,
  BarChart3,
  PieChart,
  Target,
  Leaf,
  Shield,
  Building,
  Factory,
  Zap,
  Download,
  Eye,
  EyeOff
} from "lucide-react";

interface ESGDashboardProps {
  className?: string;
}

// Investment Portfolio Data from the HTML dashboard
const INVESTMENT_PORTFOLIO = [
  { name: "Affordable Housing Bond", org: "OrgB", category: "Debt", sector: "Real Estate", amount: 9000000 },
  { name: "Blue Economy Fund", org: "OrgE", category: "Equity", sector: "Marine", amount: 8400000 },
  { name: "Circular Economy Ventures", org: "OrgD", category: "Venture Capital", sector: "Materials", amount: 3200000 },
  { name: "Clean Transport Equity", org: "OrgC", category: "Equity", sector: "Transportation", amount: 12250000 },
  { name: "Climate Tech Seed Fund", org: "OrgF", category: "Venture Capital", sector: "Technology", amount: 2100000 },
  { name: "Emerging Markets Green Bond", org: "OrgC", category: "Debt", sector: "Financials", amount: 6300000 },
  { name: "Green Affordable Housing REIT", org: "OrgD", category: "Real Estate", sector: "Real Estate", amount: 6200000 },
  { name: "Green Infrastructure Fund", org: "OrgA", category: "Equity", sector: "Utilities", amount: 10000000 },
  { name: "Industrial Decarbonization Fund", org: "OrgA", category: "Equity", sector: "Industrials", amount: 11600000 },
  { name: "Nature-Based Solutions Note", org: "OrgG", category: "Debt", sector: "Forestry", amount: 1950000 },
  { name: "Net-Zero Office Redevelopment", org: "OrgA", category: "Real Estate", sector: "Real Estate", amount: 3750000 },
  { name: "Renewable Energy Bonds", org: "OrgB", category: "Debt", sector: "Energy", amount: 5000000 },
  { name: "Smart Grid Infrastructure Trust", org: "OrgH", category: "Infrastructure", sector: "Utilities", amount: 6800000 },
  { name: "Sustainable Agriculture Fund", org: "OrgA", category: "Equity", sector: "Agriculture", amount: 7500000 },
  { name: "Sustainable Logistics REIT", org: "OrgB", category: "Real Estate", sector: "Real Estate", amount: 4500000 },
  { name: "Urban Mobility Infra Bond", org: "OrgC", category: "Infrastructure", sector: "Transportation", amount: 5600000 },
  { name: "Waste-to-Energy Infra Fund", org: "OrgE", category: "Infrastructure", sector: "Energy", amount: 7900000 },
  { name: "Water Stewardship Fund", org: "OrgE", category: "Private Equity", sector: "Water", amount: 4750000 }
];

// Calculate portfolio statistics
const TOTAL_PORTFOLIO_VALUE = INVESTMENT_PORTFOLIO.reduce((sum, inv) => sum + inv.amount, 0);
const UNIQUE_ORGANIZATIONS = [...new Set(INVESTMENT_PORTFOLIO.map(inv => inv.org))];
const SECTOR_BREAKDOWN = INVESTMENT_PORTFOLIO.reduce((acc, inv) => {
  acc[inv.sector] = (acc[inv.sector] || 0) + inv.amount;
  return acc;
}, {} as Record<string, number>);

// Mock emissions data based on investment amounts
const ORGANIZATION_EMISSIONS = UNIQUE_ORGANIZATIONS.map(org => {
  const orgInvestments = INVESTMENT_PORTFOLIO.filter(inv => inv.org === org);
  const totalAmount = orgInvestments.reduce((sum, inv) => sum + inv.amount, 0);
  const scope1 = totalAmount * 0.00008; // demo factor
  const scope2 = totalAmount * 0.00005; // demo factor  
  const scope3 = totalAmount / 12000; // demo factor
  const total = scope1 + scope2 + scope3;
  const carbonFootprint = totalAmount > 0 ? (total / (totalAmount / 1000000)) : 0;
  const coverage = (totalAmount / TOTAL_PORTFOLIO_VALUE) * 100;
  
  return {
    org,
    scope1,
    scope2, 
    scope3,
    total,
    carbonFootprint,
    coverage,
    totalAmount
  };
});

// PCAF scores (mock data based on org names)
const PCAF_SCORES = UNIQUE_ORGANIZATIONS.map(org => {
  const pseudoScore = (str: string, year: number) => {
    let sum = 0;
    for (let i = 0; i < str.length; i++) sum += str.charCodeAt(i);
    return ((sum + year) % 5) + 1;
  };
  
  return {
    org,
    score2022: pseudoScore(org, 2022),
    score2023: pseudoScore(org, 2023), 
    score2024: pseudoScore(org, 2024)
  };
});

// Mock data based on the architecture document
const mockData = {
  portfolioOverview: {
    totalAUM: "£12.8B",
    totalEmissions: "1,247,583",
    emissionIntensity: "97.4",
    esgScore: "78.2",
    complianceScore: "96.2%",
    dataQuality: "89%"
  },
  assetBreakdown: {
    corporateBonds: { value: "£7.2B", emissions: "634,291", percentage: 56.3 },
    realEstate: { value: "£3.1B", emissions: "412,875", percentage: 24.2 },
    infrastructure: { value: "£2.5B", emissions: "200,417", percentage: 19.5 }
  },
  climatRisk: {
    climateVaR: "2.3%",
    transitionRisk: "Medium",
    physicalRisk: "Low",
    carbonIntensity: "142.5"
  },
  compliance: {
    sfdr: { status: "Compliant", score: 94 },
    tcfd: { status: "Ready", score: 98 },
    sec: { status: "Pending", score: 76 }
  },
  agentStatus: {
    dataAcquisition: "Complete",
    validation: "Complete", 
    calculation: "Complete",
    assurance: "Complete",
    reporting: "Active"
  }
};

const KpiCard: React.FC<{
  title: string;
  value: string;
  change?: string;
  trend?: "up" | "down" | "neutral";
  icon: React.ReactNode;
  color?: string;
}> = ({ title, value, change, trend, icon, color = "bg-gray-100" }) => (
  <Card className="h-full">
    <CardContent className="p-4">
      <div className="flex items-center justify-between">
        <div className={`p-2 rounded-lg ${color}`}>
          {icon}
        </div>
        {change && (
          <div className={`flex items-center text-sm ${
            trend === "up" ? "text-green-600" : 
            trend === "down" ? "text-red-600" : "text-gray-600"
          }`}>
            {trend === "up" && <TrendingUp className="w-3 h-3 mr-1" />}
            {trend === "down" && <TrendingDown className="w-3 h-3 mr-1" />}
            {change}
          </div>
        )}
      </div>
      <div className="mt-3">
        <div className="text-2xl font-bold text-gray-900">{value}</div>
        <div className="text-sm text-gray-600 mt-1">{title}</div>
      </div>
    </CardContent>
  </Card>
);

const AgentStatusIndicator: React.FC<{
  agent: string;
  status: string;
}> = ({ agent, status }) => (
  <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
    <div className="text-sm font-medium text-gray-700">{agent}</div>
    <Badge 
      variant={status === "Complete" ? "default" : status === "Active" ? "secondary" : "outline"}
      className={
        status === "Complete" ? "bg-green-100 text-green-800" :
        status === "Active" ? "bg-blue-100 text-blue-800" : ""
      }
    >
      {status}
    </Badge>
  </div>
);

const EmissionsBreakdownChart: React.FC = () => (
  <div className="space-y-4">
    <div className="flex justify-between items-center">
      <span className="text-sm font-medium">Corporate Bonds</span>
      <span className="text-sm text-gray-600">£7.2B • 634k tCO₂e</span>
    </div>
    <Progress value={56.3} className="h-2" />
    
    <div className="flex justify-between items-center">
      <span className="text-sm font-medium">Real Estate</span>
      <span className="text-sm text-gray-600">£3.1B • 413k tCO₂e</span>
    </div>
    <Progress value={24.2} className="h-2" />
    
    <div className="flex justify-between items-center">
      <span className="text-sm font-medium">Infrastructure</span>
      <span className="text-sm text-gray-600">£2.5B • 200k tCO₂e</span>
    </div>
    <Progress value={19.5} className="h-2" />
  </div>
);

const ComplianceStatusGrid: React.FC = () => (
  <div className="grid grid-cols-3 gap-3">
    <div className="text-center p-3 bg-green-50 rounded-lg">
      <CheckCircle className="w-6 h-6 text-green-600 mx-auto mb-1" />
      <div className="text-xs font-medium text-green-800">SFDR</div>
      <div className="text-sm text-green-600">94%</div>
    </div>
    <div className="text-center p-3 bg-blue-50 rounded-lg">
      <Shield className="w-6 h-6 text-blue-600 mx-auto mb-1" />
      <div className="text-xs font-medium text-blue-800">TCFD</div>
      <div className="text-sm text-blue-600">98%</div>
    </div>
    <div className="text-center p-3 bg-amber-50 rounded-lg">
      <AlertTriangle className="w-6 h-6 text-amber-600 mx-auto mb-1" />
      <div className="text-xs font-medium text-amber-800">SEC</div>
      <div className="text-sm text-amber-600">76%</div>
    </div>
  </div>
);

export default function ESGDashboard({ className }: ESGDashboardProps) {
  const [showInvestmentsTable, setShowInvestmentsTable] = useState(false);
  const [showEmissionsTable, setShowEmissionsTable] = useState(false);
  const [showPCAFTable, setShowPCAFTable] = useState(false);
  const [showSectorTable, setShowSectorTable] = useState(false);
  const [showMissingDataTable, setShowMissingDataTable] = useState(false);

  // Calculate updated statistics
  const totalEmissions = ORGANIZATION_EMISSIONS.reduce((sum, org) => sum + org.total, 0);
  const avgCarbonIntensity = ORGANIZATION_EMISSIONS.reduce((sum, org) => sum + org.carbonFootprint, 0) / ORGANIZATION_EMISSIONS.length;
  const portfolioESGScore = 78.4; // Based on HTML dashboard context
  const compliancePercentage = 96.7; // Based on SFDR compliance mentioned in HTML

  return (
    <div className={`space-y-6 ${className}`}>
      {/* Header */}
      <div className="border-b pb-4">
        <div className="flex justify-between items-start">
          <div>
            <h2 className="text-2xl font-bold text-gray-900">ESG Portfolio Analytics Dashboard</h2>
            <p className="text-sm text-gray-600 mt-1">
              Comprehensive Scope 3 emissions analysis and sustainable investment insights • ${(TOTAL_PORTFOLIO_VALUE / 1000000).toFixed(1)}M Portfolio
            </p>
          </div>
          <div className="flex items-center gap-2">
            <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
              {INVESTMENT_PORTFOLIO.length} Holdings
            </Badge>
            <Badge variant="outline" className="bg-blue-50 text-blue-700 border-blue-200">
              {UNIQUE_ORGANIZATIONS.length} Organizations
            </Badge>
          </div>
        </div>
      </div>

      {/* Top KPI Row */}
      <div className="grid grid-cols-2 lg:grid-cols-6 gap-4">
        <KpiCard
          title="Total AUM"
          value={`$${(TOTAL_PORTFOLIO_VALUE / 1000000).toFixed(1)}M`}
          change="+2.3%"
          trend="up"
          icon={<BarChart3 className="w-5 h-5 text-blue-600" />}
          color="bg-blue-100"
        />
        <KpiCard
          title="Total Emissions (tCO₂e)"
          value={totalEmissions.toFixed(0)}
          change="-5.7%"
          trend="down"
          icon={<Leaf className="w-5 h-5 text-green-600" />}
          color="bg-green-100"
        />
        <KpiCard
          title="Emission Intensity"
          value={`${avgCarbonIntensity.toFixed(1)} tCO₂e/$M`}
          change="-8.1%"
          trend="down"
          icon={<Target className="w-5 h-5 text-purple-600" />}
          color="bg-purple-100"
        />
        <KpiCard
          title="Portfolio ESG Score"
          value={portfolioESGScore.toString()}
          change="+1.4"
          trend="up"
          icon={<Shield className="w-5 h-5 text-emerald-600" />}
          color="bg-emerald-100"
        />
        <KpiCard
          title="Compliance Score"
          value={`${compliancePercentage}%`}
          icon={<CheckCircle className="w-5 h-5 text-indigo-600" />}
          color="bg-indigo-100"
        />
        <KpiCard
          title="Data Quality"
          value={`${UNIQUE_ORGANIZATIONS.length} Orgs`}
          icon={<Activity className="w-5 h-5 text-orange-600" />}
          color="bg-orange-100"
        />
      </div>

      {/* Main Dashboard Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        {/* Column 1: Portfolio Composition & Emissions */}
        <div className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <PieChart className="w-5 h-5 text-blue-600" />
                Portfolio Emissions Breakdown
              </CardTitle>
            </CardHeader>
            <CardContent>
              <EmissionsBreakdownChart />
              <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                <div className="text-xs text-blue-800 font-medium">Key Insight</div>
                <div className="text-sm text-blue-700 mt-1">
                  Corporate bonds represent 56% of emissions but 58% of AUM. 
                  <span className="font-medium"> Optimization opportunity identified.</span>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Building className="w-5 h-5 text-green-600" />
                Asset Class Performance
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-2">
                    <Factory className="w-4 h-4 text-gray-600" />
                    <span className="text-sm">Corporate Bonds</span>
                  </div>
                  <div className="text-right">
                    <div className="text-sm font-medium">88.2 tCO₂e/£M</div>
                    <div className="text-xs text-red-600">+3.2% vs benchmark</div>
                  </div>
                </div>
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-2">
                    <Building className="w-4 h-4 text-gray-600" />
                    <span className="text-sm">Real Estate</span>
                  </div>
                  <div className="text-right">
                    <div className="text-sm font-medium">133.2 tCO₂e/£M</div>
                    <div className="text-xs text-green-600">-12.4% vs benchmark</div>
                  </div>
                </div>
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-2">
                    <Zap className="w-4 h-4 text-gray-600" />
                    <span className="text-sm">Infrastructure</span>
                  </div>
                  <div className="text-right">
                    <div className="text-sm font-medium">80.2 tCO₂e/£M</div>
                    <div className="text-xs text-green-600">-25.1% vs benchmark</div>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Column 2: Climate Risk & Scenario Analysis */}
        <div className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <AlertTriangle className="w-5 h-5 text-orange-600" />
                Climate Risk Assessment
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                <div className="grid grid-cols-2 gap-3">
                  <div className="text-center p-3 bg-orange-50 rounded-lg">
                    <div className="text-lg font-bold text-orange-800">2.3%</div>
                    <div className="text-xs text-orange-600">Climate VaR</div>
                  </div>
                  <div className="text-center p-3 bg-blue-50 rounded-lg">
                    <div className="text-lg font-bold text-blue-800">142.5</div>
                    <div className="text-xs text-blue-600">Carbon Intensity</div>
                  </div>
                </div>
                
                <div className="space-y-2">
                  <div className="flex justify-between">
                    <span className="text-sm">Transition Risk</span>
                    <Badge variant="outline" className="bg-yellow-50 text-yellow-700">Medium</Badge>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-sm">Physical Risk</span>
                    <Badge variant="outline" className="bg-green-50 text-green-700">Low</Badge>
                  </div>
                </div>

                <div className="mt-4 p-3 bg-orange-50 rounded-lg">
                  <div className="text-xs text-orange-800 font-medium">NGFS Scenario Analysis</div>
                  <div className="text-sm text-orange-700 mt-1">
                    Under Net Zero 2050 scenario: Portfolio VaR increases to 4.1%. 
                    <span className="font-medium">Review energy sector exposure.</span>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Shield className="w-5 h-5 text-purple-600" />
                ESG Factor Analysis
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-sm">Environmental</span>
                    <span className="text-sm font-medium">76.4</span>
                  </div>
                  <Progress value={76.4} className="h-2" />
                  
                  <div className="flex justify-between items-center">
                    <span className="text-sm">Social</span>
                    <span className="text-sm font-medium">82.1</span>
                  </div>
                  <Progress value={82.1} className="h-2" />
                  
                  <div className="flex justify-between items-center">
                    <span className="text-sm">Governance</span>
                    <span className="text-sm font-medium">79.8</span>
                  </div>
                  <Progress value={79.8} className="h-2" />
                </div>

                <div className="mt-4 p-3 bg-purple-50 rounded-lg">
                  <div className="text-xs text-purple-800 font-medium">Factor Attribution</div>
                  <div className="text-sm text-purple-700 mt-1">
                    ESG factors contributed +0.8% alpha vs benchmark over 12M.
                    <span className="font-medium"> Strong governance premium.</span>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Column 3: Compliance & Agent Status */}
        <div className="space-y-6">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <CheckCircle className="w-5 h-5 text-green-600" />
                Regulatory Compliance
              </CardTitle>
            </CardHeader>
            <CardContent>
              <ComplianceStatusGrid />
              
              <div className="mt-4 space-y-2">
                <div className="text-xs font-medium text-gray-700">Upcoming Requirements</div>
                <div className="space-y-1">
                  <div className="flex justify-between text-xs">
                    <span>SEC Climate Rule</span>
                    <span className="text-amber-600">Q4 2025</span>
                  </div>
                  <div className="flex justify-between text-xs">
                    <span>ISSB S2 Standard</span>
                    <span className="text-blue-600">Q1 2026</span>
                  </div>
                </div>
              </div>

              <div className="mt-4 p-3 bg-green-50 rounded-lg">
                <div className="text-xs text-green-800 font-medium">Compliance Status</div>
                <div className="text-sm text-green-700 mt-1">
                  96.2% compliant across all frameworks. 
                  <span className="font-medium">Ready for upcoming SEC requirements.</span>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Activity className="w-5 h-5 text-blue-600" />
                Agentic AI Workflow Status
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-2">
                <AgentStatusIndicator agent="Data Acquisition" status="Complete" />
                <AgentStatusIndicator agent="Data Validation" status="Complete" />
                <AgentStatusIndicator agent="Emissions Calculation" status="Complete" />
                <AgentStatusIndicator agent="Assurance & Audit" status="Complete" />
                <AgentStatusIndicator agent="Reporting & Publication" status="Active" />
              </div>

              <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                <div className="text-xs text-blue-800 font-medium">Automation Metrics</div>
                <div className="text-sm text-blue-700 mt-1">
                  Processing time: 8 minutes (vs 6 hours manual). 
                  <span className="font-medium">89% data quality achieved.</span>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Target className="w-5 h-5 text-emerald-600" />
                Investment Recommendations
              </CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                <div className="p-3 bg-emerald-50 rounded-lg">
                  <div className="text-xs font-medium text-emerald-800">Opportunity</div>
                  <div className="text-sm text-emerald-700 mt-1">
                    Increase infrastructure allocation by 5% to reduce portfolio carbon intensity by 12%.
                  </div>
                </div>
                
                <div className="p-3 bg-amber-50 rounded-lg">
                  <div className="text-xs font-medium text-amber-800">Risk</div>
                  <div className="text-sm text-amber-700 mt-1">
                    High Scope 3 exposure in utilities sector. Consider ESG leaders rotation.
                  </div>
                </div>
                
                <div className="p-3 bg-blue-50 rounded-lg">
                  <div className="text-xs font-medium text-blue-800">Action</div>
                  <div className="text-sm text-blue-700 mt-1">
                    Engage with 15 high-emission holdings on decarbonization roadmaps.
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* Investment Portfolio Tables */}
      <div className="space-y-6">
        <div className="border-b pb-4">
          <h3 className="text-xl font-semibold text-gray-900 mb-2">Portfolio Analysis Tables</h3>
          <p className="text-sm text-gray-600">
            Detailed breakdown of investments, emissions, and PCAF data quality scores
          </p>
        </div>

        {/* Table Controls */}
        <div className="flex flex-wrap gap-2">
          <Button
            variant={showInvestmentsTable ? "default" : "outline"}
            size="sm"
            onClick={() => setShowInvestmentsTable(!showInvestmentsTable)}
            className="h-8"
          >
            {showInvestmentsTable ? <EyeOff className="w-4 h-4 mr-1" /> : <Eye className="w-4 h-4 mr-1" />}
            Investment Holdings
          </Button>
          <Button
            variant={showEmissionsTable ? "default" : "outline"}
            size="sm"
            onClick={() => setShowEmissionsTable(!showEmissionsTable)}
            className="h-8"
          >
            {showEmissionsTable ? <EyeOff className="w-4 h-4 mr-1" /> : <Eye className="w-4 h-4 mr-1" />}
            Emissions by Organization
          </Button>
          <Button
            variant={showMissingDataTable ? "default" : "outline"}
            size="sm"
            onClick={() => setShowMissingDataTable(!showMissingDataTable)}
            className="h-8"
          >
            {showMissingDataTable ? <EyeOff className="w-4 h-4 mr-1" /> : <Eye className="w-4 h-4 mr-1" />}
            Missing & Imputed Data
          </Button>
          <Button
            variant={showSectorTable ? "default" : "outline"}
            size="sm"
            onClick={() => setShowSectorTable(!showSectorTable)}
            className="h-8"
          >
            {showSectorTable ? <EyeOff className="w-4 h-4 mr-1" /> : <Eye className="w-4 h-4 mr-1" />}
            Sector PCAF Scores
          </Button>
          <Button
            variant={showPCAFTable ? "default" : "outline"}
            size="sm"
            onClick={() => setShowPCAFTable(!showPCAFTable)}
            className="h-8"
          >
            {showPCAFTable ? <EyeOff className="w-4 h-4 mr-1" /> : <Eye className="w-4 h-4 mr-1" />}
            Organization PCAF Scores
          </Button>
        </div>

        {/* 1. Investment Holdings Table */}
        {showInvestmentsTable && (
          <Card>
            <CardHeader className="flex flex-row items-center justify-between">
              <CardTitle className="text-lg">Investment Holdings</CardTitle>
              <Button variant="outline" size="sm">
                <Download className="w-4 h-4 mr-1" />
                Export CSV
              </Button>
            </CardHeader>
            <CardContent>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left p-2 font-medium">Investment Name</th>
                      <th className="text-left p-2 font-medium">Organization</th>
                      <th className="text-left p-2 font-medium">Category</th>
                      <th className="text-left p-2 font-medium">Sector</th>
                      <th className="text-right p-2 font-medium">Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    {INVESTMENT_PORTFOLIO.map((investment, idx) => (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="p-2">{investment.name}</td>
                        <td className="p-2">
                          <Badge variant="secondary" className="text-xs">
                            {investment.org}
                          </Badge>
                        </td>
                        <td className="p-2">{investment.category}</td>
                        <td className="p-2">{investment.sector}</td>
                        <td className="p-2 text-right font-mono">
                          ${new Intl.NumberFormat('en-US').format(investment.amount)}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </CardContent>
          </Card>
        )}

        {/* 2. Consolidated Emissions by Organization Table */}
        {showEmissionsTable && (
          <Card>
            <CardHeader className="flex flex-row items-center justify-between">
              <CardTitle className="text-lg">Consolidated Emissions by Organization</CardTitle>
              <Button variant="outline" size="sm">
                <Download className="w-4 h-4 mr-1" />
                Export CSV
              </Button>
            </CardHeader>
            <CardContent>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left p-2 font-medium">Organization</th>
                      <th className="text-right p-2 font-medium">Scope 1 Emissions</th>
                      <th className="text-right p-2 font-medium">Scope 2 Emissions</th>
                      <th className="text-right p-2 font-medium">Scope 3 Emissions</th>
                      <th className="text-right p-2 font-medium">Total Emissions (tCO₂e)</th>
                      <th className="text-right p-2 font-medium">Carbon Footprint</th>
                      <th className="text-right p-2 font-medium">Coverage %</th>
                    </tr>
                  </thead>
                  <tbody>
                    {ORGANIZATION_EMISSIONS.map((org, idx) => (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="p-2">
                          <Badge variant="secondary" className="text-xs">
                            {org.org}
                          </Badge>
                        </td>
                        <td className="p-2 text-right font-mono">{org.scope1.toFixed(2)}</td>
                        <td className="p-2 text-right font-mono">{org.scope2.toFixed(2)}</td>
                        <td className="p-2 text-right font-mono">{org.scope3.toFixed(2)}</td>
                        <td className="p-2 text-right font-mono font-semibold">{org.total.toFixed(2)}</td>
                        <td className="p-2 text-right font-mono">{org.carbonFootprint.toFixed(2)} tCO₂e/$M</td>
                        <td className="p-2 text-right font-mono">{org.coverage.toFixed(1)}%</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </CardContent>
          </Card>
        )}

        {/* 3. Missing and Imputed Data Table */}
        {showMissingDataTable && (
          <Card>
            <CardHeader className="flex flex-row items-center justify-between">
              <CardTitle className="text-lg">Missing and Imputed Data</CardTitle>
              <Button variant="outline" size="sm">
                <Download className="w-4 h-4 mr-1" />
                Export CSV
              </Button>
            </CardHeader>
            <CardContent>
              <p className="text-xs text-gray-600 mb-3">Generated from uploaded data placeholders; values are illustrative.</p>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left p-2 font-medium">Organization</th>
                      <th className="text-left p-2 font-medium">Scope</th>
                      <th className="text-left p-2 font-medium">Missing Data Element</th>
                      <th className="text-left p-2 font-medium">Imputation Method</th>
                      <th className="text-right p-2 font-medium">Imputed Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    {UNIQUE_ORGANIZATIONS.map((org, idx) => (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="p-2">
                          <Badge variant="secondary" className="text-xs">
                            {org}
                          </Badge>
                        </td>
                        <td className="p-2">Scope 3</td>
                        <td className="p-2">Emissions</td>
                        <td className="p-2">Investment-weighted scaling (demo)</td>
                        <td className="p-2 text-right font-mono">
                          {(ORGANIZATION_EMISSIONS.find(e => e.org === org)?.scope3 || 0).toFixed(2)} tCO₂e
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </CardContent>
          </Card>
        )}

        {/* 4. Sector-wise PCAF Scores Table */}
        {showSectorTable && (
          <Card>
            <CardHeader className="flex flex-row items-center justify-between">
              <CardTitle className="text-lg">Sector-wise Breakdown with PCAF Scores</CardTitle>
              <Button variant="outline" size="sm">
                <Download className="w-4 h-4 mr-1" />
                Export CSV
              </Button>
            </CardHeader>
            <CardContent>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left p-2 font-medium">Sector</th>
                      <th className="text-right p-2 font-medium">Investments</th>
                      <th className="text-right p-2 font-medium">Total Amount</th>
                      <th className="text-right p-2 font-medium">2022</th>
                      <th className="text-right p-2 font-medium">2023</th>
                      <th className="text-right p-2 font-medium">2024</th>
                    </tr>
                  </thead>
                  <tbody>
                    {Object.entries(SECTOR_BREAKDOWN).sort(([a], [b]) => a.localeCompare(b)).map(([sector, amount], idx) => {
                      const count = INVESTMENT_PORTFOLIO.filter(inv => inv.sector === sector).length;
                      const pseudoScore = (str: string, year: number) => {
                        let sum = 0;
                        for (let i = 0; i < str.length; i++) sum += str.charCodeAt(i);
                        return ((sum + year) % 5) + 1;
                      };
                      
                      return (
                        <tr key={idx} className="border-b hover:bg-gray-50">
                          <td className="p-2">{sector}</td>
                          <td className="p-2 text-right font-mono">{count}</td>
                          <td className="p-2 text-right font-mono">
                            ${new Intl.NumberFormat('en-US').format(amount)}
                          </td>
                          <td className="p-2 text-right font-mono">{pseudoScore(sector, 2022)}</td>
                          <td className="p-2 text-right font-mono">{pseudoScore(sector, 2023)}</td>
                          <td className="p-2 text-right font-mono">{pseudoScore(sector, 2024)}</td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </CardContent>
          </Card>
        )}

        {/* 5. Organization-wise PCAF Scores Table */}
        {showPCAFTable && (
          <Card>
            <CardHeader className="flex flex-row items-center justify-between">
              <CardTitle className="text-lg">Organization-wise PCAF Scores (2022–2024)</CardTitle>
              <Button variant="outline" size="sm">
                <Download className="w-4 h-4 mr-1" />
                Export CSV
              </Button>
            </CardHeader>
            <CardContent>
              <p className="text-xs text-gray-600 mb-3">
                PCAF Data Quality Score: <span className="bg-blue-100 px-2 py-1 rounded">1 = Highest quality</span> … <span className="bg-gray-100 px-2 py-1 rounded">5 = Lowest quality</span>
              </p>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b">
                      <th className="text-left p-2 font-medium">Organization</th>
                      <th className="text-right p-2 font-medium">2022</th>
                      <th className="text-right p-2 font-medium">2023</th>
                      <th className="text-right p-2 font-medium">2024</th>
                    </tr>
                  </thead>
                  <tbody>
                    {PCAF_SCORES.map((score, idx) => (
                      <tr key={idx} className="border-b hover:bg-gray-50">
                        <td className="p-2">
                          <Badge variant="secondary" className="text-xs">
                            {score.org}
                          </Badge>
                        </td>
                        <td className="p-2 text-right font-mono">{score.score2022}</td>
                        <td className="p-2 text-right font-mono">{score.score2023}</td>
                        <td className="p-2 text-right font-mono">{score.score2024}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Footer Actions */}
      <div className="border-t pt-4">
        <div className="flex justify-between items-center">
          <div className="text-sm text-gray-600">
            Next data refresh: <span className="font-medium">Tomorrow 6:00 AM</span>
          </div>
          <div className="flex gap-3">
            <button className="px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
              Export Report
            </button>
            <button className="px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
              Schedule Review
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
